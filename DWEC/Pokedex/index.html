<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Cartas Pokémon</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <style>
        .carta {
            border: 1px solid #000;
            padding: 10px;
            margin: 5px;
            display: inline-block;
            text-align: center;
        }
        .tablero {
            margin: 20px;
            padding: 10px;
            border: 1px solid #000;
        }
        .reportero {
            position: fixed;
            bottom: 10px;
            right: 10px;
            padding: 10px;
            border: 1px solid #000;
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Puntos acumulados -->
        <div>
            <h1>Puntos Jugador: {{ totalPlayer }}</h2>
            <h2>Puntos Máquina: {{ totalMachine }}</h2>
        </div>

        <!-- Cartas ganadas -->
        <div>
            <h3>Cartas Ganadas por el Jugador:</h3>
            <div v-for="carta in cartasPlayer" :key="carta.name" class="carta">
                <img :src="carta.image" :alt="carta.name" width="100">
                <div>{{ carta.name }}</div>
                <div>{{ carta.experience }}</div>
            </div>
        </div>

        <div>
            <h3>Cartas Ganadas por la Máquina:</h3>
            <div v-for="carta in cartasMachine" :key="carta.name" class="carta">
                <img :src="carta.image" :alt="carta.name" width="100">
                <div>{{ carta.name }}</div>
                <div>{{ carta.experience }}</div>
            </div>
        </div>

        <!-- Tablero de juego -->
        <div class="tablero">
            <h3>Tablero</h3>
            <div>
                <h4>Jugador:</h4>
                <div v-for="carta in tableroPlayer" :key="carta.name" class="carta">
                    <img :src="carta.image" :alt="carta.name" width="100">
                    <div>{{ carta.name }}</div>
                    <div>{{ carta.experience }}</div>
                </div>
            </div>
            <div>
                <h4>Máquina:</h4>
                <div v-for="carta in tableroMachine" :key="carta.name" class="carta">
                    <img :src="carta.image" :alt="carta.name" width="100">
                    <div>{{ carta.name }}</div>
                    <div>{{ carta.experience }}</div>
                </div>
            </div>
        </div>

        <!-- Cartas del jugador -->
        <div>
            <h3>Tu Mano:</h3>
            <div v-for="(carta, index) in manoPlayer" :key="carta.name" class="carta" @click="jugarCarta(index)">
                <img :src="carta.image" :alt="carta.name" width="100">
                <div>{{ carta.name }}</div>
                <div>{{ carta.experience }}</div>
            </div>
        </div>

        <!-- Reportero -->
        <div class="reportero">
            <div v-if="estado === 'cargando'">
                Cargando... <img src="loading.gif" alt="Cargando">
            </div>
            <div v-if="estado === 'deliberando'">
                Deliberando... <img src="loading.gif" alt="Deliberando">
            </div>
            <div v-if="estado === 'jugadaMaquina'">
                La máquina está jugando... <img src="loading.gif" alt="Jugada Máquina">
            </div>
            <div v-if="estado === 'tuTurno'">
                ¡Tu turno!
            </div>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                totalPlayer: 0,
                totalMachine: 0,
                cartasPlayer: [],
                cartasMachine: [],
                tableroPlayer: [],
                tableroMachine: [],
                manoPlayer: [],
                manoMachine: [],
                estado: 'cargando',
                pokemons: []
            },
            created() {
                this.cargarPokemons();
            },
            methods: {
                async cargarPokemons() {
                    try {
                        const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=151');
                        const data = await response.json();
                        this.pokemons = data.results;
                        this.repartirCartas();
                        this.estado = 'tuTurno';
                    } catch (error) {
                        console.error('Error cargando Pokémon:', error);
                    }
                },
                async repartirCartas() {
                    for (let i = 0; i < 5; i++) {
                        const pokemonPlayer = await this.obtenerPokemonAleatorio();
                        const pokemonMachine = await this.obtenerPokemonAleatorio();
                        this.manoPlayer.push(pokemonPlayer);
                        this.manoMachine.push(pokemonMachine);
                    }
                },
                async obtenerPokemonAleatorio() {
                    const randomIndex = Math.floor(Math.random() * this.pokemons.length);
                    const pokemonUrl = this.pokemons[randomIndex].url;
                    const response = await fetch(pokemonUrl);
                    const data = await response.json();
                    return {
                        name: data.name,
                        experience: data.base_experience,
                        image: data.sprites.front_default
                    };
                },
                jugarCarta(index) {
                    const cartaJugada = this.manoPlayer.splice(index, 1)[0];
                    this.tableroPlayer.push(cartaJugada);
                    this.estado = 'deliberando';
                    setTimeout(() => this.jugadaMaquina(), 1000);
                },
                jugadaMaquina() {
                    const cartaJugador = this.tableroPlayer[this.tableroPlayer.length - 1];
                    let cartaMaquina = null;

                    // Lógica de la IA
                    const cartaSuperior = this.manoMachine.find(carta => carta.experience > cartaJugador.experience);
                    if (cartaSuperior) {
                        cartaMaquina = cartaSuperior;
                    } else {
                        cartaMaquina = this.manoMachine[0];
                    }

                    this.manoMachine = this.manoMachine.filter(carta => carta !== cartaMaquina);
                    this.tableroMachine.push(cartaMaquina);

                    this.resolverJugada(cartaJugador, cartaMaquina);
                },
                resolverJugada(cartaJugador, cartaMaquina) {
                    if (cartaJugador.experience > cartaMaquina.experience) {
                        this.totalPlayer += cartaJugador.experience + cartaMaquina.experience;
                        this.cartasPlayer.push(cartaJugador, cartaMaquina);
                    } else if (cartaJugador.experience < cartaMaquina.experience) {
                        this.totalMachine += cartaJugador.experience + cartaMaquina.experience;
                        this.cartasMachine.push(cartaJugador, cartaMaquina);
                    } else {
                        // Empate, se reparte una carta a cada uno
                        this.manoPlayer.push(this.obtenerPokemonAleatorio());
                        this.manoMachine.push(this.obtenerPokemonAleatorio());
                    }

                    this.tableroPlayer = [];
                    this.tableroMachine = [];

                    if (this.totalPlayer >= 1000 || this.totalMachine >= 1000) {
                        alert(this.totalPlayer >= 1000 ? '¡Ganaste!' : '¡La máquina ganó!');
                        this.reiniciarJuego();
                    } else {
                        this.estado = 'tuTurno';
                    }
                },
                reiniciarJuego() {
                    this.totalPlayer = 0;
                    this.totalMachine = 0;
                    this.cartasPlayer = [];
                    this.cartasMachine = [];
                    this.tableroPlayer = [];
                    this.tableroMachine = [];
                    this.manoPlayer = [];
                    this.manoMachine = [];
                    this.estado = 'cargando';
                    this.cargarPokemons();
                }
            }
        });
    </script>
</body>
</html>